define(["jquery"],function(e){"use strict";return{initialise:function(){console.log("Custom module initialised"),e(document).ready(function(){var i=e("#region-main"),t=e("#add_notification_wrapper_id"),n={save:"Save",update:"Update",req:"Required field...",preview:"Preview",title:"Title",message:"Message"};i.on("click",".notifications_table tr > td > form > input[type=submit]",function(i){i.preventDefault();var t={call:"ajax",purpose:"",tableaction:""},o=e(this).closest("form").attr("data-edit"),a=e(this).closest("form").attr("data-delete");if(c(),void 0!==o&&!1!==o){t.purpose="edit",t.tableaction=o;var d=e("#add_notification_save");d.addClass("update"),d.val(n.update)}else void 0!==a&&!1!==a&&(t.purpose="delete",t.tableaction=a);var f=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;e.post(f,t).fail(function(){console.error("No 'manage' response received.")}).done(function(i){if(i=JSON.parse(i),parseInt(i.done,10)>0)e("#tr"+i.done).closest("tr").fadeOut(250,function(){e(this).remove(),l(),r()});else if("edit"===t.purpose){for(var n in i)if(i.hasOwnProperty(n)){if("id"===n){var o=e("#add_notification_form");e("#add_notification_id").remove(),o.prepend('<input type="hidden" id="add_notification_id" name="id" value="'+i[n]+'"/>'),e("#add_notification_purpose").val("update")}var a=e("#add_notification_wrapper_id").find("#add_notification_"+n);"enabled"!==n&&"global"!==n&&"dismissible"!==n&&"aicon"!==n||1!=i[n]?"enabled"!==n&&"global"!==n&&"dismissible"!==n&&"aicon"!==n||0!=i[n]?a.val(i[n]):a.prop("checked",!1):a.prop("checked",!0)}s()}})}),i.on("click",".notifications_restore_table tr > td > form > input[type=submit]",function(i){i.preventDefault();var t={call:"ajax",purpose:"",tableaction:""},n=e(this).closest("form").attr("data-restore"),o=e(this).closest("form").attr("data-permdelete");void 0!==n&&!1!==n?(t.purpose="restore",t.tableaction=n):void 0!==o&&!1!==o&&(t.purpose="permdelete",t.tableaction=o);var a=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;e.post(a,t).fail(function(){console.error("No 'restore/permdelete' response received.")}).done(function(i){i=JSON.parse(i),parseInt(i.done,10)>0&&e("#tr"+i.done).closest("tr").fadeOut(250,function(){e(this).remove()})})}),t.on("click","#add_notification_cancel",function(e){e.preventDefault(),l()}),i.on("submit","#add_notification_form",function(i){i.preventDefault();var t=e("#add_notification_status"),o=e("#add_notification_form");if(c(),d()){t.show();var a=e(this).serialize(),s=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php";e.post(s,a).fail(function(i){console.error("No 'add' response received.");var a=i.responseJSON.error;for(var s in a)if(a.hasOwnProperty(s)){var r=o.find("select[name="+a[s]+"]");r.addClass("requiredfield"),e('<strong class="requiredfield"><em>'+n.req+"</em><strong>").insertAfter(r[0].nextSibling)}t.hide()}).done(function(){t.find(".saving").hide(),t.find(".done").show(),l(),setTimeout(function(){t.fadeOut(function(){t.find(".done").hide(),t.find(".saving").show()})},1500),e("#advnotifications_table_wrapper").load("# #advnotifications_table_wrapper > *")})}}),t.on("input propertychange paste","#add_notification_title, #add_notification_message",function(){s()}),e("#add_notification_type").on("change",function(){s()}),e("#add_notification_dismissible").on("change",function(){s()}),e("#add_notification_aicon").on("change",function(){s()});var o,a,s=function(){var i=t.find("#add_notification_title");i.val().length>0?t.find(".preview-title")[0].innerHTML=i.val():t.find(".preview-title")[0].innerHTML=n.title;var o=t.find("#add_notification_message");o.val().length>0?t.find(".preview-message")[0].innerHTML=o.val():t.find(".preview-message")[0].innerHTML=n.message;var a=e("#add_notification_type").val(),s=e("#add_notification_wrapper_id .preview-alert");"info"!==a&&"success"!==a&&"warning"!==a&&"danger"!==a&&(a="info"),s.removeClass("alert-info alert-success alert-danger alert-warning"),s.addClass("alert-"+a),e(".preview-aicon").find("> img").attr("src",M.util.image_url(a,"block_advnotifications")),e("#add_notification_dismissible")[0].checked?e(".preview-alert-dismissible").show():e(".preview-alert-dismissible").hide(),e("#add_notification_aicon")[0].checked?e(".preview-aicon").show():e(".preview-aicon").hide()},r=function(){var i=e("#notification_preview_wrapper"),o='<div id="notification_preview_wrapper"><strong>'+n.preview+'</strong><br><div class="alert alert-info preview-alert"><div class="preview-aicon" style="display: none;"><img src="'+M.util.image_url("info","block_advnotifications")+'" /></div><strong class="preview-title">'+n.title+'</strong> <div class="preview-message">'+n.message+'</div> <div class="preview-alert-dismissible" style="display: none;"><strong>&times;</strong></div></div></div>';i.length>0?(i.remove(),e(o).prependTo(e(t))):e(o).prependTo(e(t)).hide().slideDown()},d=function(){var i=e("#add_notification_form select option:selected:disabled");for(var t in i)if(i.hasOwnProperty(t)&&e(i[t]).prop("disabled"))return e(i[t]).closest("select").addClass("requiredfield"),e('<strong class="requiredfield"><em>'+n.req+"</em><strong>").insertAfter(e(i[t]).closest("select")[0].nextSibling),!1;return!0},c=function(){e("select.requiredfield").removeClass("requiredfield"),e("strong.requiredfield").remove()},l=function(){e("#add_notification_form")[0].reset(),c(),r();var i=e("#add_notification_save");i.removeClass("update"),e("#add_notification_id").remove(),e("#add_notification_purpose").val("add"),i.val(n.save)};o={call:"ajax",purpose:"strings"},a=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey,e.post(a,o).fail(function(){console.error("No 'strings' response received.")}).done(function(e){n=e}).always(function(){r()}),e("#add_notification_form").append('<input type="hidden" id="add_notification_call" name="call" value="ajax"/>')})}}});